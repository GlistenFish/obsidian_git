# TCP/IP 面试题  
## 1 、简述 TCP 的三次握手和四次挥手  
SYN:请求建立连接，FIN：请求断开连接，ACK:确认是否有效， seq:序列号， ack:确认号  

1）三次握手  

1.客户端向服务端发送⼀个 SYN=1（请求建立连接），并生成一个序列号 seq=j。

2.服务端接收到 SYN=1后，给客户端发送⼀个 SYN=1与 ACK=1；并将 ack 置为 j+1;同时生成一个序列号 seq=k。

3.客户端接收到会检查 ack 是否为 j+1与 ACK 是否为1，如果是，则会给服务端发送一个 ACK=1与 ack=k+1，以及自己的序列号 seq=j=1; 服务端接收到会检查 ACK 是否为1与 ack 是否为 k+1,如果是则代表连接建立成功，两者间可以传递数据。

2）四次挥手

1.客户端向服务端发送 FIN=1（请求关闭连接），并生成一个序列号 seq=x。

2.服务端接收 FIN 后，向客户端发送 ACK=1，ack=x+1，并生成序列号 seq=y（客户端无数据发送，但服务器端需发送完最后的数据）。

3.服务端处理完所有数据后，向客户端发送 FIN=1与 ACK=1，ack=x+1，并生成序列号 z，表示服务端现在可以断开连接。

4.客户端收到服务端的数据包后，会向服务端发送 ACK=1,seq=x=1，ack=z+1（需要等待2MSL 后才可断开连接）。

## 2 、为什么是三次握手而不是两次握手？
        因为如果客户端第一次发送的 SYN 报文因为网络问题而迟迟没有到达服务端，此时客户端会因为超时而重新发送一个新的 SYN 报文，此时上一个 SYN 报文在客户端就会失效，如果这里只采用两次握手，会因为客户端第二次发送 SYN 后，第一次发送的 SYN 又成功到达服务端，这时就会建立两个连接，产生问题。

## 3 、为什么连接的时候是三次握手，关闭的时候却是四次握手？
        因为当 Server 端收到 Client 端的 SYN 连接请求报文后，可以直接发送 SYN+ACK 报文。其中 ACK 报文是用来应答的，SYN 报文是用来同步的。但是关闭连接时，当 Server 端收到 FIN 报文时，很可能并不会立即关闭 SOCKET，所以只能先回复一个 ACK 报文，告诉 Client 端，"你发的 FIN 报文我收到了"。只有等到我 Server 端所有的报文都发送完了，我才能发送 FIN 报文，因此不能一起发送。故需要四步握手。

## 4 、为什么需要经过2MSL(报文段在网络中最大生存时间)才能返回到 CLOSE 状态？
        是为了给最后一次发送的 ACK 报文成功到达服务端预留时间，因为如果因为网络阻塞最后一次 ACK 未能及时到达服务端，服务端会以为客户端为收到上一次发送的 FIN 报文，则服务端会重新发送 FIN 报文，而这是客户端已经断开连接了，这时就是产生错乱的问题。

## 5 、TCP 与 UDP 的区别
UDP 适合广播发送，效率高但是不可靠。

TCP 适合两个对象间传递数据，可靠性高但是效率低。
